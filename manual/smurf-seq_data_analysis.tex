\documentclass[11pt]{article}

\usepackage{fullpage,times}
\usepackage{graphicx}
\usepackage{float}
\usepackage[hidelinks]{hyperref}

\title{Data analysis procedure for SMURF-seq reads}
\date{}

\newenvironment{cmd}
{\list{}{
    \parsep=0em
    \itemindent=17pt
    \listparindent=50pt
    \leftmargin=0in
    \rightmargin=0in
  }\item[] \ttfamily \$}
{\endlist}

\begin{document}
\maketitle
\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Intro                                                                %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Introduction}
SMURF-seq is a protocol to efficiently sequence short DNA molecules on
a long-read sequencer by randomly ligating them to form
long molecules.
%
The SMURF-seq protocol involves cleaving the genomic DNA into short
fragments. These fragmented molecules are then randomly ligated back
together to form artificial, long DNA molecules. The long re-ligated
molecules are sequenced following the standard MinION library
preparation protocol. After (or possibly concurrent with) sequencing,
the SMURF-seq reads are mapped to the reference genome in a way that
simultaneously splits them into their constituent fragments, each
aligning to a distinct location in the genome (for most fragments).

%
This manual explains how to map SMURF-seq reads, generate copy-number profiles
from the mapped fragments, and perform additional optional analysis of the
sequenced read or the mapped fragments.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Mapping SMURF-seq reads                                              %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Mapping SMURF-seq reads}
At this point, we assume that the reads generated from a
SMURF-seq experiment are base-called and are in a fastq or
fasta file.

The reads sequenced using SMURF-seq protocol needs to be mapped to the
reference genome to identify the fragment locations. The reads can be
aligned leveraging long-read mapping tools that are designed for split-read
alignment.

We present the option of aligning SMURF-seq reads using BWA-MEM
\cite{li2013aligning}, Minimap2 \cite{li2018minimap2}, and LAST
\cite{kielbasa2011adaptive}, and we present several parameter
recommendations for each tool.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Prerequisites}
\paragraph{Reference genome:} The CNV analysis procedure described in
section \ref{cnv} makes use of the human reference genome build
\texttt{hg19}, and thus this build has to used to generate CNV profiles
using the procedure described here. However, other reference genomes
can be utilized if the user does not used the procedure in \ref{cnv}

\paragraph{Software required:}
\begin{enumerate}
  \item Mapping tool: One of BWA, Minimap2, or LAST.
  \item samtools \cite{li2009sequence} (version: 1.9)
\end{enumerate}

\paragraph{Environment variables:}
Required only when using the provided scripts for mapping SMURF-seq reads.
The variable \texttt{MAPPER} can be set using:
\begin{cmd}
  export MAPPER=<path to mapping tool>
\end{cmd}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Mapping SMURF-seq reads to the reference genome}

A user has an option of using either of the tools listed above following
the procedure in section \ref{bwa}, \ref{minimap}, or \ref{last}
respectively. We recommend using BWA-MEM as this produced higher
fragment counts.

\subsubsection{Mapping SMURF-seq reads with BWA-MEM}
The download and install instructions for BWA can be found at:
\url{https://github.com/lh3/bwa}

\label{bwa}
\paragraph{Reference genome index creation:}
The reference genome index in created using the command:
\begin{cmd}
  bwa index <genome file>
\end{cmd}
The index occupies approximately xxx GB for hg19.

\paragraph{Parameter recommendations:}
The default parameter to map nanopore reads using BWA-MEM is \texttt{-x~ont2d}.
SMURF-seq reads can be aligned using just this option, however, the fragment
lengths were longer than optimal. We recommend using the parameters
\texttt{-A 1 -B 2 -O 0 -E 2} in addition to \texttt{-x~ont2d}. These
parameters constrain the growth of a fragment and their lengths were close to
optimal. To further increase the number of fragments obtained, at the
expense of a longer runtime, the minimum seed length (\texttt{k}) and the
minimum chain weight (\texttt{W}) can be lowered.


\paragraph{Aligning SMURF-seq reads:}
SMURF-seq reads are mapped to the reference genome using for fast mapping:
\begin{cmd}
  bwa mem -x ont2d -A 1 -B 2 -O 0 -E 2 -t <threads> $\backslash$ \par
  <index> <reads>
\end{cmd}
or using to obtain a higher fragment count:
\begin{cmd}
  bwa mem -x ont2d -k 11 -W 5 -A 1 -B 2 -O 0 -E 2 -t <threads> $\backslash$
  \par <index> <reads>
\end{cmd}

\noindent
The above commands can also be run using the scripts:
\begin{cmd}
  ./map/smurfseq\_BWA\_fast.sh <index> <reads>
\end{cmd}

\noindent
or
\begin{cmd}
  ./map/smurfseq\_BWA\_frags.sh <index> <reads>
\end{cmd}
\noindent
respectively. These scripts require environment variable \texttt{MAPPER}
set to the location of BWA.



\subsubsection{Mapping SMURF-seq reads with Minimap2}
\label{minimap}
\paragraph{Reference genome index creation (Optional)}

\paragraph{Aligning SMURF-seq reads}

\paragraph{Parameter recommendations}



\subsubsection{Mapping SMURF-seq reads with LAST}
\label{last}
\paragraph{Reference genome index creation}

\paragraph{Aligning SMURF-seq reads}

\paragraph{Parameter recommendations}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Generating mapping statistics}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Test data}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% CNV profile generation                                               %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Generation of copy-number profiles}
\label{cnv}

\subsection{Prerequisites}
\paragraph{Software required:}

\subsection{Generating CNV profiles}

\paragraph{Generating higher-resolution CNV profiles}

\subsection{Test data}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Misc. analysis                                                       %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Miscellaneous analysis of sequenced reads and mapped fragments}

\subsection{Read length distribution}

\subsection{Fragment length distribution}

\subsection{Closeness to RE sites}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% References                                                           %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{unsrt}
\bibliography{smurf-seq_data_analysis}

\end{document}
